(()=>{"use strict";var e={966:(e,t,s)=>{e.exports=s.p+"70b86524e51744f35789.ico"},423:(e,t,s)=>{e.exports=s.p+"c2fc95356945a2723bfc.svg"},286:(e,t,s)=>{e.exports=s.p+"4e8e0a1d604782a0dff8.svg"}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}s.p="",(()=>{class e{constructor(e,t){this._formElement=t,this._config=e}_showInputError(e,t){const s=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this._config.errorClass),s.textContent=t,s.classList.add(this._config.inputErrorClass)}_hideInputError(e){const t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._config.errorClass),t.classList.remove(this._config.inputErrorClass),t.textContent=""}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._config.inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._config.inactiveButtonClass))}_checkInputValidity(e){e.addEventListener("input",function(){this._toggleButtonState(),e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}.bind(this))}_setEventListeners(){this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector),this._inputList.forEach((e=>{this._checkInputValidity(e)}))}resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._setEventListeners(),this._formElement.addEventListener("submit",(function(e){e.preventDefault()}))}}class t{constructor(e,t,s,r,i,o){this._handleCardClick=s,this._handleCardDelete=r,this._handleCardLike=i,this.userId=o,this.cardOwnerId=e.owner._id,this.cardId=e._id,this._name=e.name,this._link=e.link,this._likes=e.likes,this._cardTemplate=document.querySelector(t).content,this._cardElement=this._cardTemplate.querySelector(".card").cloneNode(!0),this._cardLikesCount=this._cardElement.querySelector(".card__like-counter"),this._cardLike=this._cardElement.querySelector(".card__like")}_setEventListeners(){this._cardLike.addEventListener("click",(()=>this._handleCardLike(this))),null!=this._cardDeleteElm&&this._cardDeleteElm.addEventListener("click",(()=>this._handleCardDelete(this))),this._cardImgElm.addEventListener("click",(()=>{const e={link:this._cardImgElm.src,name:this._cardImgElm.alt};this._handleCardClick(e)}))}removeCard(){this._cardElement.remove(),this._cardElement=null}isLiked(){return this._likes.some((e=>e._id===this.userId))}toggleLike(e){this.isLiked()?this._cardLike.classList.remove("btn-like_state_active"):this._cardLike.classList.add("btn-like_state_active"),this._likes=e,this._cardLikesCount.textContent=this._likes.length}createCard(e){const t=this._cardElement.querySelector(".card__name");return this._cardImgElm=this._cardElement.querySelector(".card__img"),this._cardDeleteElm=this._cardElement.querySelector(".card__delete-card"),t.textContent=this._name,this._cardLikesCount.textContent=this._likes.length,this._cardImgElm.setAttribute("src",this._link),this._cardImgElm.setAttribute("alt",this._name),this._likes.forEach((t=>{t._id===e&&this._cardLike.classList.add("btn-like_state_active")})),this.cardOwnerId!=e&&(this._cardDeleteElm.remove(),this._cardDeleteElm=null),this._setEventListeners(),this._cardElement}}const r={loadingBlueUrl:s(423),headerLogoURL:s(286),faviconURL:s(966)},i={inputSelector:".popup__input",submitButtonSelector:".popup__btn-submit",inactiveButtonClass:"popup__btn-submit_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class n{constructor(e){o(this,"_handleEscClose",(e=>{"Escape"===e.key&&this.close()})),o(this,"_handleClose",(e=>{const t=e.target.classList;(t.contains("overlay__btn-close")||t.contains("overlay"))&&(e.stopPropagation(),this.close())})),this._popup=document.querySelector(e),this.close=this.close.bind(this)}open(){this._popup.classList.add("overlay_visible"),this.setEventListeners()}close(){this._popup.classList.remove("overlay_visible"),this._popup.removeEventListener("mousedown",this._handleClose),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("mousedown",this._handleClose),document.addEventListener("keydown",this._handleEscClose)}}class a extends n{constructor(e,t){super(e),this._submitHandler=t,this._form=this._popup.querySelector(".form"),this._handleSubmit=this._handleSubmit.bind(this),this._submitButton=this._popup.querySelector(".popup__btn-submit"),this._submitButtonTextBeforeLoading=this._submitButton.textContent}_getInputValues(){const e={};return[...this._form.querySelectorAll(".popup__input")].forEach((t=>e[t.name]=t.value)),e}setEventListeners(){this._form.addEventListener("submit",this._handleSubmit),super.setEventListeners()}_setLoading(){this._submitButton.classList.add("popup__btn-submit_inactive"),this._submitButton.textContent+="...",this._submitButton.disabled=!0}_removeLoading(){this._submitButton.classList.remove("popup__btn-submit_inactive"),this._submitButton.textContent=this._submitButtonTextBeforeLoading,this._submitButton.disabled=!1}_handleSubmit(e){e.preventDefault(),this._setLoading(),this._submitHandler(this._getInputValues())}close(){this._form.removeEventListener("submit",this._handleSubmit),this._form.reset(),super.close(),this._removeLoading()}}class l{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}render(){this._items.forEach((e=>this._renderer(e)))}addItem(e){null!=e&&this._container.prepend(e)}}const c=new class{constructor(e){let{baseUrl:t,headers:s}=e;var r,i;i=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject(e.statusText))).catch((e=>console.error("Error:",e))),(r="customFetch")in this?Object.defineProperty(this,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[r]=i,this._baseUrl=t,this._headers={headers:s}}getUserInfo(){return this.customFetch("".concat(this._baseUrl,"/users/me"),this._headers)}getInitialCards(){return this.customFetch("".concat(this._baseUrl,"/cards"),this._headers)}createNewCard(e){return this.customFetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers.headers,body:JSON.stringify(e)})}setProfileInfo(e){const t={name:e.profileName,about:e.profileTitle,avatar:e.profileAvatar};return this.customFetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers.headers,body:JSON.stringify(t)})}deleteCard(e){return this.customFetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers.headers})}addLike(e){return this.customFetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers.headers})}removeLike(e){return this.customFetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers.headers})}setAvatar(e){return this.customFetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers.headers,body:JSON.stringify(e)})}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"89275f46-d96a-420c-9a94-a2948b040a2e","Content-Type":"application/json"}}),d="#formCard",h="#formProfile",u="#formProfileAvatar",_=document.querySelector(h),m=document.querySelector(u),p=new class{constructor(e){this._profileName=document.querySelector(e.profileNameSelector),this._profileTitle=document.querySelector(e.profileTitleSelector),this._avatar=document.querySelector(e.profileAvatarSelector),this.userId}getUserInfo(){return{profileName:this._profileName.textContent,profileTitle:this._profileTitle.textContent}}setUserInfo(e){let{profileName:t,profileTitle:s}=e;this._profileName.textContent=t,this._profileTitle.textContent=s}getUserAvatar(){return{profileName:this._profileName.textContent,profileTitle:this._profileTitle.textContent}}setUserAvatar(e){this._avatar.src=e}}({profileNameSelector:".profile__name",profileTitleSelector:".profile__title",profileAvatarSelector:".profile__avatar"}),f=document.querySelector(d);let v,b=document.querySelector("#cardsLoading");const E=new class extends a{setAction(e){this._submitHandler=e}}("#popupConfirmAction"),L=new class extends n{constructor(e){super(e),this._popupImage=this._popup.querySelector(".overlay__img")}open(e){let{name:t,link:s}=e;const r=this._popup.querySelector(".overlay__text");this._popupImage.src=s,this._popupImage.alt=t,r.textContent=t,this.setEventListeners(),super.open()}}("#overlayImage"),g=new a(d,(e=>{c.createNewCard(e).then((e=>{q(e),g.close()}))})),y=new a(h,(e=>{c.setProfileInfo(e).then((()=>{p.setUserInfo(e),y.close()}))})),C=new a(u,(e=>{c.setAvatar(e).then((()=>{p.setUserAvatar(e.avatar),C.close()}))})),k=new e(i,f),S=new e(i,_),I=new e(i,m);function q(e){const s=new t(e,"#card",x,U,w,p.userId);v.addItem(s.createCard(p.userId))}function x(e){L.open(e)}function U(e){E.open(),E.setAction((()=>{c.deleteCard(e.cardId).then((()=>{e.removeCard(),E.close()}))}))}function w(e){e.isLiked()?c.removeLike(e.cardId).then((t=>e.toggleLike(t.likes))):c.addLike(e.cardId).then((t=>e.toggleLike(t.likes)))}S.enableValidation(),k.enableValidation(),I.enableValidation(),Promise.all([c.getUserInfo(),c.getInitialCards()]).then((e=>{let[t,s]=e;p.userId=t._id;const r={profileName:t.name,profileTitle:t.about,avatar:t.avatar};p.setUserInfo(r),p.setUserAvatar(r.avatar),b.remove(),b=null,v=new l({items:s,renderer:q},".cards"),v.render()})),function(){const e=document.querySelector("#profileAvatar"),t=document.querySelector("#headerLogo"),s=document.querySelector("#favicon"),{loadingBlueUrl:i,headerLogoURL:o,faviconURL:n}=r;e.src=i,t.src=o,b.src=i,s.href=n}(),document.querySelector(".profile__edit-info").addEventListener("click",(function(){!function(e){const t=document.querySelector("#profileName"),s=document.querySelector("#profileTitle"),{profileName:r,profileTitle:i}=e;t.value=r,s.value=i}(p.getUserInfo()),S.resetValidation(),y.open()})),document.querySelector(".profile__add").addEventListener("click",(()=>{k.resetValidation(),g.open()})),document.querySelector("#profileAvatarEdit").addEventListener("click",(()=>{I.resetValidation(),C.open()}))})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUVmRCxFQUFrQixJQUFJbEUsRUFBUSxDQUMxQkUsTUFBT3FGLEVBQ1BwRixTQUFVd0UsR0F6RUQsVUE0RWJULEVBQWdCM0QsWUFLNUIsV0FDSSxNQUFNcUMsRUFBZ0JqRyxTQUFTdEQsY0FBYyxrQkFFdkNtTSxFQUFhN0ksU0FBU3RELGNBQWMsZUFDcENvTSxFQUFVOUksU0FBU3RELGNBQWMsYUFDakMsZUFBRXFNLEVBQUYsY0FBa0JDLEVBQWxCLFdBQWlDQyxHQUFlNUgsRUFDdEQ0RSxFQUFjeEYsSUFBTXNJLEVBQ3BCRixFQUFXcEksSUFBTXVJLEVBQ2pCeEIsRUFBYS9HLElBQU1zSSxFQUNuQkQsRUFBUUksS0FBT0QsRUFLZkUsR0EwRkpuSixTQUFTdEQsY0FBYyx1QkFDbEJtQixpQkFBaUIsU0EzRXRCLFlBUkEsU0FBeUIyQyxHQUNyQixNQUFNcUYsRUFBYzdGLFNBQVN0RCxjQTlHUixnQkErR2ZxSixFQUFlL0YsU0FBU3RELGNBOUdSLGtCQStHZG1KLFlBQWF1RCxFQUFVckQsYUFBY3NELEdBQVk3SSxFQUN6RHFGLEVBQVk1QyxNQUFRbUcsRUFDcEJyRCxFQUFhOUMsTUFBUW9HLEVBSXJCQyxDQUFnQjFDLEVBQVN6QixlQUN6QmlELEVBQXFCN0osa0JBQ3JCMEosRUFBYWpHLFVBMEVqQmhDLFNBQVN0RCxjQUFjLGlCQUNsQm1CLGlCQUFpQixTQUFTLEtBQ3ZCc0ssRUFBa0I1SixrQkFDbEJ3SixFQUFhL0YsVUFHckJoQyxTQUFTdEQsY0FBYyxzQkFDbEJtQixpQkFBaUIsU0FBUyxLQUN2QndLLEVBQTJCOUosa0JBQzNCMkosRUFBZ0JsRyxXIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJvamVjdC04L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3Byb2plY3QtOC93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9wcm9qZWN0LTgvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3Byb2plY3QtOC8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJvamVjdC04Ly4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9wcm9qZWN0LTgvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcm9qZWN0LTgvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3Byb2plY3QtOC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vcHJvamVjdC04Ly4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3Byb2plY3QtOC8uL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3Byb2plY3QtOC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3Byb2plY3QtOC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aFN1Ym1pdC5qcyIsIndlYnBhY2s6Ly9wcm9qZWN0LTgvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZywgZm9ybUVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50XHJcbiAgICAgICAgdGhpcy5fY29uZmlnID0gY29uZmlnXHJcbiAgICB9XHJcblxyXG4gICAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xyXG4gICAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2NvbmZpZy5lcnJvckNsYXNzKTtcclxuICAgICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgICB9O1xyXG5cclxuICAgIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XHJcbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fY29uZmlnLmVycm9yQ2xhc3MpO1xyXG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2NvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgX2hhc0ludmFsaWRJbnB1dCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xyXG4gICAgICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9jb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XHJcbiAgICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgICAgICAgICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcclxuICAgIH07XHJcblxyXG5cclxuXHJcbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0ID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2NvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XHJcbiAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICAgICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpXHJcbiAgICAgICAgfSlcclxuICAgIH07XHJcblxyXG4gICAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbigpIHtcclxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24oZXZ0KSB7XHJcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xuICAgIGNvbnN0cnVjdG9yKGNhcmREYXRhLCBzZWxlY3RvciwgY2FyZENsaWNrLCBjYXJkRGVsZXRlLCBjYXJkTGlrZSwgdXNlcklkKSB7XG4gICAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGNhcmRDbGlja1xuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlID0gY2FyZERlbGV0ZVxuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkTGlrZSA9IGNhcmRMaWtlXG5cbiAgICAgICAgdGhpcy51c2VySWQgPSB1c2VySWRcbiAgICAgICAgdGhpcy5jYXJkT3duZXJJZCA9IGNhcmREYXRhLm93bmVyLl9pZFxuICAgICAgICB0aGlzLmNhcmRJZCA9IGNhcmREYXRhLl9pZFxuXG4gICAgICAgIHRoaXMuX25hbWUgPSBjYXJkRGF0YS5uYW1lXG4gICAgICAgIHRoaXMuX2xpbmsgPSBjYXJkRGF0YS5saW5rXG4gICAgICAgIHRoaXMuX2xpa2VzID0gY2FyZERhdGEubGlrZXNcbiAgICAgICAgdGhpcy5fY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvcikuY29udGVudDtcbiAgICAgICAgdGhpcy5fY2FyZEVsZW1lbnQgPSB0aGlzLl9jYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgdGhpcy5fY2FyZExpa2VzQ291bnQgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtY291bnRlclwiKVxuICAgICAgICB0aGlzLl9jYXJkTGlrZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZVwiKVxuICAgIH1cbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG5cbiAgICAgICAgdGhpcy5fY2FyZExpa2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZUNhcmRMaWtlKHRoaXMpKVxuXG4gICAgICAgIGlmICh0aGlzLl9jYXJkRGVsZXRlRWxtICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX2NhcmREZWxldGVFbG0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZUNhcmREZWxldGUodGhpcykpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9jYXJkSW1nRWxtLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0geyBsaW5rOiB0aGlzLl9jYXJkSW1nRWxtLnNyYywgbmFtZTogdGhpcy5fY2FyZEltZ0VsbS5hbHQgfVxuICAgICAgICAgICAgdGhpcy5faGFuZGxlQ2FyZENsaWNrKGRhdGEpXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgcmVtb3ZlQ2FyZCgpIHtcbiAgICAgICAgdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gbnVsbDtcbiAgICB9XG5cbiAgICBpc0xpa2VkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGlrZXMuc29tZShsaWtlID0+IGxpa2UuX2lkID09PSB0aGlzLnVzZXJJZClcbiAgICB9XG5cbiAgICB0b2dnbGVMaWtlKGxpa2VzUmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNMaWtlZCgpKSB7XG4gICAgICAgICAgICB0aGlzLl9jYXJkTGlrZS5jbGFzc0xpc3QucmVtb3ZlKFwiYnRuLWxpa2Vfc3RhdGVfYWN0aXZlXCIpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9jYXJkTGlrZS5jbGFzc0xpc3QuYWRkKFwiYnRuLWxpa2Vfc3RhdGVfYWN0aXZlXCIpXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbGlrZXMgPSBsaWtlc1Jlc3BvbnNlXG4gICAgICAgIHRoaXMuX2NhcmRMaWtlc0NvdW50LnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoXG4gICAgfVxuICAgIGNyZWF0ZUNhcmQodXNlcklkKSB7XG4gICAgICAgIC8qICAgICAgLy8vIHRlc3QgbWV0aG9kXG4gICAgICAgICAgICAgaWYgKHVzZXJJZCAhPT0gdGhpcy5jYXJkT3duZXJJZCkge1xuICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICAgICAgIH0gKi9cblxuICAgICAgICBjb25zdCBjYXJkTmFtZUVsbSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbmFtZVwiKVxuXG4gICAgICAgIHRoaXMuX2NhcmRJbWdFbG0gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltZ1wiKVxuICAgICAgICB0aGlzLl9jYXJkRGVsZXRlRWxtID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtY2FyZFwiKVxuXG4gICAgICAgIGNhcmROYW1lRWxtLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZVxuICAgICAgICB0aGlzLl9jYXJkTGlrZXNDb3VudC50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aFxuICAgICAgICB0aGlzLl9jYXJkSW1nRWxtLnNldEF0dHJpYnV0ZShcInNyY1wiLCB0aGlzLl9saW5rKVxuICAgICAgICB0aGlzLl9jYXJkSW1nRWxtLnNldEF0dHJpYnV0ZShcImFsdFwiLCB0aGlzLl9uYW1lKVxuXG4gICAgICAgIHRoaXMuX2xpa2VzLmZvckVhY2goY2FyZCA9PiB7XG4gICAgICAgICAgICBpZiAoY2FyZC5faWQgPT09IHVzZXJJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NhcmRMaWtlLmNsYXNzTGlzdC5hZGQoXCJidG4tbGlrZV9zdGF0ZV9hY3RpdmVcIilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gcmVtb3ZlIGRlbGV0ZSBidXR0b24gZnJvbSBjYXJkcyB0aGF0IGlzIG5vdCBiZWxvbmdzIHRvIHRoZSB1c2VyXG4gICAgICAgIGlmICh0aGlzLmNhcmRPd25lcklkICE9IHVzZXJJZCkge1xuICAgICAgICAgICAgdGhpcy5fY2FyZERlbGV0ZUVsbS5yZW1vdmUoKVxuICAgICAgICAgICAgdGhpcy5fY2FyZERlbGV0ZUVsbSA9IG51bGxcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKClcblxuICAgICAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnRcbiAgICB9XG5cbn0iLCJpbXBvcnQgbG9hZGluZ0JsdWVVcmwgZnJvbSBcIi4uLy4uL2ltZy9sb2FkaW5nL2xvYWRpbmdCbHVlLnN2Z1wiO1xyXG5pbXBvcnQgaGVhZGVyTG9nb1VSTCBmcm9tIFwiLi4vLi4vaW1nL2xvZ28vbG9nby5zdmdcIjtcclxuaW1wb3J0IGZhdmljb25VUkwgZnJvbSBcIi4uLy4uL2ltZy9mYXZpY29uL2Zhdmljb24uaWNvXCJcclxuXHJcbmV4cG9ydCBjb25zdCBpbmRleEltYWdlVXJscyA9IHtcclxuICAgIFwibG9hZGluZ0JsdWVVcmxcIjogbG9hZGluZ0JsdWVVcmwsXHJcbiAgICBcImhlYWRlckxvZ29VUkxcIjogaGVhZGVyTG9nb1VSTCxcclxuICAgIFwiZmF2aWNvblVSTFwiOiBmYXZpY29uVVJMXHJcbn1cclxuXHJcblxyXG4vLyBDb25maWdzXHJcbmV4cG9ydCBjb25zdCBmb3JtQ29uZmlnSW5kZXggPSB7XHJcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcclxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fYnRuLXN1Ym1pdFwiLFxyXG4gICAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnRuLXN1Ym1pdF9pbmFjdGl2ZVwiLFxyXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgICBlcnJvckNsYXNzOiBcInBvcHVwX19lcnJvcl92aXNpYmxlXCJcclxufTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZWxlY3Rvcikge1xyXG4gICAgICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5jbG9zZSA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKVxyXG4gICAgfVxyXG5cclxuICAgIG9wZW4oKSB7XHJcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChcIm92ZXJsYXlfdmlzaWJsZVwiKVxyXG4gICAgICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwib3ZlcmxheV92aXNpYmxlXCIpXHJcbiAgICAgICAgdGhpcy5fcG9wdXAucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9oYW5kbGVDbG9zZSlcclxuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSlcclxuXHJcbiAgICB9XHJcblxyXG5cclxuICAgIF9oYW5kbGVFc2NDbG9zZSA9IChlKSA9PiB7XHJcblxyXG4gICAgICAgIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9oYW5kbGVDbG9zZSA9IChlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWxtQ2xhc3NMaXN0ID0gZS50YXJnZXQuY2xhc3NMaXN0O1xyXG4gICAgICAgIGlmIChlbG1DbGFzc0xpc3QuY29udGFpbnMoXCJvdmVybGF5X19idG4tY2xvc2VcIikgfHwgZWxtQ2xhc3NMaXN0LmNvbnRhaW5zKFwib3ZlcmxheVwiKSkge1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG5cclxuICAgICAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZUNsb3NlKVxyXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKVxyXG4gICAgfVxyXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvciwgc3VibWl0SGFuZGxlcikge1xyXG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpXHJcbiAgICAgICAgdGhpcy5fc3VibWl0SGFuZGxlciA9IHN1Ym1pdEhhbmRsZXJcclxuICAgICAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpXHJcbiAgICAgICAgdGhpcy5faGFuZGxlU3VibWl0ID0gdGhpcy5faGFuZGxlU3VibWl0LmJpbmQodGhpcylcclxuICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19idG4tc3VibWl0XCIpXHJcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uVGV4dEJlZm9yZUxvYWRpbmcgPSB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnRcclxuICAgIH1cclxuICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgICAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHt9XHJcbiAgICAgICAgY29uc3QgaW5wdXRzTGlzdCA9IFsuLi50aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2lucHV0XCIpXVxyXG4gICAgICAgIGlucHV0c0xpc3QuZm9yRWFjaChpbnB1dCA9PiBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlKVxyXG4gICAgICAgIHJldHVybiBpbnB1dFZhbHVlc1xyXG4gICAgfVxyXG5cclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCB0aGlzLl9oYW5kbGVTdWJtaXQpXHJcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKVxyXG4gICAgfVxyXG5cclxuICAgIF9zZXRMb2FkaW5nKCkge1xyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwicG9wdXBfX2J0bi1zdWJtaXRfaW5hY3RpdmVcIilcclxuICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgKz0gXCIuLi5cIlxyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgX3JlbW92ZUxvYWRpbmcoKSB7XHJcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9fYnRuLXN1Ym1pdF9pbmFjdGl2ZVwiKVxyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRoaXMuX3N1Ym1pdEJ1dHRvblRleHRCZWZvcmVMb2FkaW5nXHJcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBfaGFuZGxlU3VibWl0KGUpIHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcclxuICAgICAgICB0aGlzLl9zZXRMb2FkaW5nKClcclxuICAgICAgICB0aGlzLl9zdWJtaXRIYW5kbGVyKHRoaXMuX2dldElucHV0VmFsdWVzKCkpXHJcbiAgICB9XHJcbiAgICBjbG9zZSgpIHtcclxuICAgICAgICB0aGlzLl9mb3JtLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5faGFuZGxlU3VibWl0KVxyXG4gICAgICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcclxuXHJcbiAgICAgICAgc3VwZXIuY2xvc2UoKVxyXG4gICAgICAgIHRoaXMuX3JlbW92ZUxvYWRpbmcoKTtcclxuICAgIH1cclxuXHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMgPSBpdGVtcztcclxuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpXHJcblxyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlcigpIHtcclxuICAgICAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gdGhpcy5fcmVuZGVyZXIoaXRlbSkpXHJcbiAgICB9XHJcblxyXG4gICAgYWRkSXRlbShlbGVtZW50KSB7XHJcblxyXG4gICAgICAgIGlmIChlbGVtZW50ICE9PSBudWxsICYmIGVsZW1lbnQgIT09IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSIsImNsYXNzIEFwaSB7XHJcbiAgICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xyXG4gICAgICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsXHJcbiAgICAgICAgdGhpcy5faGVhZGVycyA9IHsgXCJoZWFkZXJzXCI6IGhlYWRlcnMgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBjdXN0b21GZXRjaCA9ICh1cmwsIG9wdGlvbnMpID0+IHtcclxuICAgICAgICByZXR1cm4gZmV0Y2godXJsLCBvcHRpb25zKVxyXG4gICAgICAgICAgICAudGhlbihyZXMgPT4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXNUZXh0KSlcclxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvcjpcIiwgZXJyb3IpKVxyXG4gICAgfVxyXG5cclxuICAgIGdldFVzZXJJbmZvKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwgdGhpcy5faGVhZGVycylcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwgdGhpcy5faGVhZGVycylcclxuXHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlTmV3Q2FyZChkYXRhKSB7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLmhlYWRlcnMsXHJcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBzZXRQcm9maWxlSW5mbyhkYXRhKSB7XHJcbiAgICAgICAgY29uc3QgdXNlck9iaiA9IHtcclxuICAgICAgICAgICAgbmFtZTogZGF0YS5wcm9maWxlTmFtZSxcclxuICAgICAgICAgICAgYWJvdXQ6IGRhdGEucHJvZmlsZVRpdGxlLFxyXG4gICAgICAgICAgICBhdmF0YXI6IGRhdGEucHJvZmlsZUF2YXRhclxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMuaGVhZGVycyxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkodXNlck9iailcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMuaGVhZGVycyxcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGFkZExpa2UoY2FyZElkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMuaGVhZGVycyxcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUxpa2UoY2FyZElkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMuaGVhZGVycyxcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHNldEF2YXRhcihsaW5rKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycy5oZWFkZXJzLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShsaW5rKVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gICAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgYXV0aG9yaXphdGlvbjogXCI4OTI3NWY0Ni1kOTZhLTQyMGMtOWE5NC1hMjk0OGIwNDBhMmVcIixcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxyXG4gICAgfVxyXG59KTsiLCIvLyAgaW1wb3J0c1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgeyBmb3JtQ29uZmlnSW5kZXgsIGluZGV4SW1hZ2VVcmxzIH0gZnJvbSBcIi4uL3NyYy91dGlscy9jb25zdGFudHMuanNcIlxyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanNcIlxyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiXHJcbmltcG9ydCB7IGFwaSB9IGZyb20gXCIuLi9zcmMvY29tcG9uZW50cy9BcGkuanNcIlxyXG5pbXBvcnQgJy4vaW5kZXguY3NzJ1xyXG5pbXBvcnQgUG9wdXBXaXRoU3VibWl0IGZyb20gXCIuLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhTdWJtaXQuanNcIjtcclxuXHJcblxyXG5cclxuLy8gIFNlbGVjdG9yc1xyXG5jb25zdCBwcm9maWxlSW5mb1NlbGVjdG9ycyA9IHtcclxuICAgIHByb2ZpbGVOYW1lU2VsZWN0b3I6IFwiLnByb2ZpbGVfX25hbWVcIixcclxuICAgIHByb2ZpbGVUaXRsZVNlbGVjdG9yOiBcIi5wcm9maWxlX190aXRsZVwiLFxyXG4gICAgcHJvZmlsZUF2YXRhclNlbGVjdG9yOiBcIi5wcm9maWxlX19hdmF0YXJcIlxyXG59XHJcbmNvbnN0IHByb2ZpbGVGb3JtU2VsZWN0b3JzID0ge1xyXG4gICAgcHJvZmlsZU5hbWVTZWxlY3RvcjogXCIjcHJvZmlsZU5hbWVcIixcclxuICAgIHByb2ZpbGVUaXRsZVNlbGVjdG9yOiBcIiNwcm9maWxlVGl0bGVcIixcclxuICAgIHByb2ZpbGVBdmF0YXJJbWFnZVNlbGVjdG9yOiBcIiNhdmF0YXJJbWFnZVwiXHJcbn1cclxuXHJcbmNvbnN0IG92ZXJsYXlJbWFnZVNlbGVjdG9yID0gXCIjb3ZlcmxheUltYWdlXCI7XHJcbmNvbnN0IGNhcmRMaXN0U2VsZWN0b3IgPSBcIi5jYXJkc1wiXHJcbmNvbnN0IGNhcmRUZW1wbGF0ZVNlbGVjdG9yID0gXCIjY2FyZFwiO1xyXG5jb25zdCBjYXJkRm9ybVNlbGVjdG9yID0gJyNmb3JtQ2FyZCdcclxuY29uc3QgcHJvZmlsZUZvcm1TZWxlY3RvciA9ICcjZm9ybVByb2ZpbGUnXHJcbmNvbnN0IHByb2ZpbGVBdmF0YXJGb3JtU2VsZWN0b3IgPSAnI2Zvcm1Qcm9maWxlQXZhdGFyJ1xyXG5jb25zdCBwb3B1cENvbmZpcm1BY3Rpb25TZWxlY3RvciA9IFwiI3BvcHVwQ29uZmlybUFjdGlvblwiXHJcblxyXG4vLyBQcm9maWxlIHZhcmlhYmxlc1xyXG5jb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocHJvZmlsZUZvcm1TZWxlY3RvcilcclxuY29uc3QgcHJvZmlsZUF2YXRhckZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2ZpbGVBdmF0YXJGb3JtU2VsZWN0b3IpXHJcblxyXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhwcm9maWxlSW5mb1NlbGVjdG9ycylcclxuXHJcbi8vICBDYXJkIHZhcmlhYmxlc1xyXG5jb25zdCBjYXJkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY2FyZEZvcm1TZWxlY3RvcilcclxubGV0IGNhcmRzTG9hZGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZHNMb2FkaW5nXCIpO1xyXG5sZXQgY2FyZExpc3RTZWN0aW9uO1xyXG5cclxuLy8gIFBvcHVwc1xyXG5jb25zdCBwb3B1cERlbGV0ZUNhcmQgPSBuZXcgUG9wdXBXaXRoU3VibWl0KHBvcHVwQ29uZmlybUFjdGlvblNlbGVjdG9yKVxyXG5jb25zdCBwb3B1cFdpdGhJbWFnZSA9IG5ldyBQb3B1cFdpdGhJbWFnZShvdmVybGF5SW1hZ2VTZWxlY3RvcilcclxuXHJcbmNvbnN0IHBvcHVwQWRkQ2FyZCA9IG5ldyBQb3B1cFdpdGhGb3JtKGNhcmRGb3JtU2VsZWN0b3IsIGRhdGEgPT4ge1xyXG4gICAgYXBpLmNyZWF0ZU5ld0NhcmQoZGF0YSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgYWRkQ2FyZChyZXMpXHJcbiAgICAgICAgcG9wdXBBZGRDYXJkLmNsb3NlKClcclxuICAgIH0pXHJcbn0pXHJcblxyXG5jb25zdCBwb3B1cFByb2ZpbGUgPSBuZXcgUG9wdXBXaXRoRm9ybShwcm9maWxlRm9ybVNlbGVjdG9yLCBkYXRhID0+IHtcclxuICAgIGFwaS5zZXRQcm9maWxlSW5mbyhkYXRhKS50aGVuKCgpID0+IHtcclxuICAgICAgICB1c2VySW5mby5zZXRVc2VySW5mbyhkYXRhKVxyXG4gICAgICAgIHBvcHVwUHJvZmlsZS5jbG9zZSgpXHJcbiAgICB9KVxyXG59KVxyXG5cclxuY29uc3QgcG9wdXBBdmF0YXJFZGl0ID0gbmV3IFBvcHVwV2l0aEZvcm0ocHJvZmlsZUF2YXRhckZvcm1TZWxlY3RvciwgbGluayA9PiB7XHJcbiAgICBhcGkuc2V0QXZhdGFyKGxpbmspLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJBdmF0YXIobGluay5hdmF0YXIpXHJcbiAgICAgICAgcG9wdXBBdmF0YXJFZGl0LmNsb3NlKClcclxuICAgIH0pXHJcbn0pXHJcblxyXG5cclxuLy8gRm9ybXMgVmFsaWRhdGlvbnNcclxuY29uc3QgY2FyZEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtQ29uZmlnSW5kZXgsIGNhcmRGb3JtKVxyXG5jb25zdCBwcm9maWxlRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1Db25maWdJbmRleCwgcHJvZmlsZUZvcm0pXHJcbmNvbnN0IHByb2ZpbGVBdmF0YXJGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZ0luZGV4LCBwcm9maWxlQXZhdGFyRm9ybSlcclxuXHJcbnByb2ZpbGVGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKVxyXG5jYXJkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKClcclxucHJvZmlsZUF2YXRhckZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpXHJcblxyXG4vLyNyZWdpb24gaW5pdGlhbGl6ZVBhZ2VcclxuZnVuY3Rpb24gZ2V0SW5pdGlhbERhdGEoKSB7XHJcblxyXG4gICAgUHJvbWlzZS5hbGwoW2FwaS5nZXRVc2VySW5mbygpLCBhcGkuZ2V0SW5pdGlhbENhcmRzKCldKS50aGVuKFxyXG4gICAgICAgIChbdXNlciwgY2FyZEl0ZW1zXSkgPT4ge1xyXG4gICAgICAgICAgICB1c2VySW5mby51c2VySWQgPSB1c2VyLl9pZFxyXG4gICAgICAgICAgICBjb25zdCB1c2VyT2JqID0ge1xyXG4gICAgICAgICAgICAgICAgcHJvZmlsZU5hbWU6IHVzZXIubmFtZSxcclxuICAgICAgICAgICAgICAgIHByb2ZpbGVUaXRsZTogdXNlci5hYm91dCxcclxuICAgICAgICAgICAgICAgIGF2YXRhcjogdXNlci5hdmF0YXJcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdXNlckluZm8uc2V0VXNlckluZm8odXNlck9iailcclxuICAgICAgICAgICAgdXNlckluZm8uc2V0VXNlckF2YXRhcih1c2VyT2JqLmF2YXRhcilcclxuXHJcbiAgICAgICAgICAgIGNhcmRzTG9hZGluZy5yZW1vdmUoKVxyXG4gICAgICAgICAgICBjYXJkc0xvYWRpbmcgPSBudWxsXHJcblxyXG4gICAgICAgICAgICBjYXJkTGlzdFNlY3Rpb24gPSBuZXcgU2VjdGlvbih7XHJcbiAgICAgICAgICAgICAgICBpdGVtczogY2FyZEl0ZW1zLFxyXG4gICAgICAgICAgICAgICAgcmVuZGVyZXI6IGFkZENhcmRcclxuICAgICAgICAgICAgfSwgY2FyZExpc3RTZWxlY3RvcilcclxuXHJcbiAgICAgICAgICAgIGNhcmRMaXN0U2VjdGlvbi5yZW5kZXIoKVxyXG4gICAgICAgIH0pXHJcbn1cclxuXHJcbi8vIFNldCBpbmRleCBpbWFnZXNcclxuZnVuY3Rpb24gaW5pdEluZGV4SW1hZ2VzKCkge1xyXG4gICAgY29uc3QgcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZUF2YXRhclwiKTtcclxuXHJcbiAgICBjb25zdCBoZWFkZXJMb2dvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNoZWFkZXJMb2dvXCIpO1xyXG4gICAgY29uc3QgZmF2aWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZmF2aWNvblwiKTtcclxuICAgIGNvbnN0IHsgbG9hZGluZ0JsdWVVcmwsIGhlYWRlckxvZ29VUkwsIGZhdmljb25VUkwgfSA9IGluZGV4SW1hZ2VVcmxzXHJcbiAgICBwcm9maWxlQXZhdGFyLnNyYyA9IGxvYWRpbmdCbHVlVXJsO1xyXG4gICAgaGVhZGVyTG9nby5zcmMgPSBoZWFkZXJMb2dvVVJMO1xyXG4gICAgY2FyZHNMb2FkaW5nLnNyYyA9IGxvYWRpbmdCbHVlVXJsXHJcbiAgICBmYXZpY29uLmhyZWYgPSBmYXZpY29uVVJMO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpbml0aWFsaXplUGFnZSgpIHtcclxuICAgIGdldEluaXRpYWxEYXRhKClcclxuICAgIGluaXRJbmRleEltYWdlcygpXHJcbn1cclxuaW5pdGlhbGl6ZVBhZ2UoKVxyXG5cclxuLy8jZW5kcmVnaW9uXHJcblxyXG5cclxuLy8gIFByb2ZpbGUgU2VjdGlvblxyXG5mdW5jdGlvbiBmaWxsUHJvZmlsZUZvcm0oZGF0YSkge1xyXG4gICAgY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2ZpbGVGb3JtU2VsZWN0b3JzLnByb2ZpbGVOYW1lU2VsZWN0b3IpXHJcbiAgICBjb25zdCBwcm9maWxlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2ZpbGVGb3JtU2VsZWN0b3JzLnByb2ZpbGVUaXRsZVNlbGVjdG9yKVxyXG4gICAgY29uc3QgeyBwcm9maWxlTmFtZTogdXNlck5hbWUsIHByb2ZpbGVUaXRsZTogdXNlckpvYiB9ID0gZGF0YVxyXG4gICAgcHJvZmlsZU5hbWUudmFsdWUgPSB1c2VyTmFtZVxyXG4gICAgcHJvZmlsZVRpdGxlLnZhbHVlID0gdXNlckpvYlxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFZGl0UHJvZmlsZUJ1dHRvbkNsaWNrKCkge1xyXG4gICAgZmlsbFByb2ZpbGVGb3JtKHVzZXJJbmZvLmdldFVzZXJJbmZvKCkpXHJcbiAgICBwcm9maWxlRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKVxyXG4gICAgcG9wdXBQcm9maWxlLm9wZW4oKTtcclxufVxyXG4vLyAgI3JlZ2lvbiBDYXJkIFNlY3Rpb25cclxuXHJcblxyXG4vKiBmdW5jdGlvbiB0ZXN0aW5nX19BZGRDYXJkKGNhcmRzQ291bnQpIHtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FyZHNDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgaW1hZ2VzTGlua3MgPSB7XHJcbiAgICAgICAgICAgIDA6IFwiaHR0cHM6Ly9pbWFnZXMucGV4ZWxzLmNvbS9waG90b3MvMjkxNzg3MS9wZXhlbHMtcGhvdG8tMjkxNzg3MS5qcGVnXCIsXHJcbiAgICAgICAgICAgIDE6IFwiaHR0cHM6Ly9pbWFnZXMucGV4ZWxzLmNvbS9waG90b3MvMjkxNzg3MS9wZXhlbHMtcGhvdG8tMjkxNzg3MS5qcGVnXCIsXHJcbiAgICAgICAgICAgIDI6IFwiaHR0cHM6Ly9pbWFnZXMucGV4ZWxzLmNvbS9waG90b3MvNjEzNTM4OC9wZXhlbHMtcGhvdG8tNjEzNTM4OC5qcGVnXCIsXHJcbiAgICAgICAgICAgIDM6IFwiaHR0cHM6Ly9pbWFnZXMucGV4ZWxzLmNvbS9waG90b3MvNjEzNTM4OC9wZXhlbHMtcGhvdG8tNjEzNTM4OC5qcGVnXCIsXHJcbiAgICAgICAgICAgIDQ6IFwiaHR0cHM6Ly9pbWFnZXMucGV4ZWxzLmNvbS9waG90b3MvMTY5NjQ3L3BleGVscy1waG90by0xNjk2NDcuanBlZ1wiLFxyXG4gICAgICAgICAgICA1OiBcImh0dHBzOi8vaW1hZ2VzLnBleGVscy5jb20vcGhvdG9zLzI0ODg2Ny9wZXhlbHMtcGhvdG8tMjQ4ODY3LmpwZWdcIixcclxuICAgICAgICAgICAgNjogXCJodHRwczovL2ltYWdlcy5wZXhlbHMuY29tL3Bob3Rvcy8xNDM3MTI2L3BleGVscy1waG90by0xNDM3MTI2LmpwZWdcIixcclxuICAgICAgICAgICAgNzogXCJodHRwczovL2ltYWdlcy5wZXhlbHMuY29tL3Bob3Rvcy83MjAyMzUvcGV4ZWxzLXBob3RvLTcyMDIzNS5qcGVnXCIsXHJcbiAgICAgICAgICAgIDg6IFwiaHR0cHM6Ly9pbWFnZXMucGV4ZWxzLmNvbS9waG90b3MvNDk3NjMzOS9wZXhlbHMtcGhvdG8tNDk3NjMzOS5qcGVnXCIsXHJcbiAgICAgICAgICAgIDk6IFwiaHR0cHM6Ly9pbWFnZXMucGV4ZWxzLmNvbS9waG90b3MvMTEwODU3Mi9wZXhlbHMtcGhvdG8tMTEwODU3Mi5qcGVnXCIsXHJcbiAgICAgICAgICAgIDEwOiBcImh0dHBzOi8vaW1hZ2VzLnBleGVscy5jb20vcGhvdG9zLzQwOTY5Ni9wZXhlbHMtcGhvdG8tNDA5Njk2LmpwZWdcIixcclxuICAgICAgICAgICAgMTE6IFwiaHR0cHM6Ly9oZGZyZWV3YWxscGFwZXIubmV0L3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDE1LzA5L2Zsb3dlcnMtcm9zZS1nYXJkZW4td2FsbHBhcGVyLWZyZWUtaGQtZm9yLWRlc2t0b3AtMTAyNHg2NDAuanBnXCJcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGlkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOSk7XHJcbiAgICAgICAgY29uc3QgY2FyZERhdGEgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6IGB0ZXN0ICR7aX0gYCxcclxuICAgICAgICAgICAgbGluazogaW1hZ2VzTGlua3NbYCR7aWR9YF1cclxuICAgICAgICB9XHJcbiAgICAgICAgcG9wdXBBZGRDYXJkLl9zdWJtaXRIYW5kbGVyKGNhcmREYXRhKVxyXG4gICAgfVxyXG59XHJcbiAqL1xyXG5cclxuXHJcbmZ1bmN0aW9uIGFkZENhcmQoZGF0YSkge1xyXG4gICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKGRhdGEsXHJcbiAgICAgICAgY2FyZFRlbXBsYXRlU2VsZWN0b3IsXHJcbiAgICAgICAgaGFuZGxlQ2FyZENsaWNrLFxyXG4gICAgICAgIGhhbmRsZUNhcmREZWxldGUsXHJcbiAgICAgICAgaGFuZGxlQ2FyZExpa2UsXHJcbiAgICAgICAgdXNlckluZm8udXNlcklkKVxyXG5cclxuICAgIGNhcmRMaXN0U2VjdGlvbi5hZGRJdGVtKGNhcmQuY3JlYXRlQ2FyZCh1c2VySW5mby51c2VySWQpKVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVDYXJkQ2xpY2soaW1hZ2VEYXRhKSB7XHJcbiAgICBwb3B1cFdpdGhJbWFnZS5vcGVuKGltYWdlRGF0YSlcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ2FyZERlbGV0ZShjYXJkKSB7XHJcbiAgICBwb3B1cERlbGV0ZUNhcmQub3BlbigpXHJcbiAgICBwb3B1cERlbGV0ZUNhcmQuc2V0QWN0aW9uKCgpID0+IHtcclxuICAgICAgICBhcGkuZGVsZXRlQ2FyZChjYXJkLmNhcmRJZCkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGNhcmQucmVtb3ZlQ2FyZCgpXHJcbiAgICAgICAgICAgIHBvcHVwRGVsZXRlQ2FyZC5jbG9zZSgpXHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBoYW5kbGVDYXJkTGlrZShjYXJkKSB7XHJcbiAgICBpZiAoY2FyZC5pc0xpa2VkKCkpIHtcclxuICAgICAgICBhcGkucmVtb3ZlTGlrZShjYXJkLmNhcmRJZCkudGhlbihyZXMgPT4gY2FyZC50b2dnbGVMaWtlKHJlcy5saWtlcykpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFwaS5hZGRMaWtlKGNhcmQuY2FyZElkKS50aGVuKChyZXMpID0+IGNhcmQudG9nZ2xlTGlrZShyZXMubGlrZXMpKVxyXG4gICAgfVxyXG59XHJcblxyXG4vLyNlbmRyZWdpb25cclxuXHJcbi8vIEV2ZW50IExpc3RlbmVyc1xyXG5cclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWluZm8nKVxyXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVFZGl0UHJvZmlsZUJ1dHRvbkNsaWNrKTtcclxuXHJcbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQnKVxyXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgY2FyZEZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKClcclxuICAgICAgICBwb3B1cEFkZENhcmQub3BlbigpXHJcbiAgICB9KVxyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlQXZhdGFyRWRpdFwiKVxyXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgcHJvZmlsZUF2YXRhckZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKClcclxuICAgICAgICBwb3B1cEF2YXRhckVkaXQub3BlbigpXHJcblxyXG4gICAgfSkiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgICBjb25zdHJ1Y3RvcihkYXRhKSB7XHJcbiAgICAgICAgdGhpcy5fcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGRhdGEucHJvZmlsZU5hbWVTZWxlY3RvcilcclxuICAgICAgICB0aGlzLl9wcm9maWxlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGRhdGEucHJvZmlsZVRpdGxlU2VsZWN0b3IpXHJcbiAgICAgICAgdGhpcy5fYXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihkYXRhLnByb2ZpbGVBdmF0YXJTZWxlY3RvcilcclxuXHJcbiAgICAgICAgdGhpcy51c2VySWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJvZmlsZU5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxyXG4gICAgICAgICAgICBwcm9maWxlVGl0bGU6IHRoaXMuX3Byb2ZpbGVUaXRsZS50ZXh0Q29udGVudFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRVc2VySW5mbyh7IHByb2ZpbGVOYW1lLCBwcm9maWxlVGl0bGUgfSkge1xyXG4gICAgICAgIHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gcHJvZmlsZU5hbWVcclxuICAgICAgICB0aGlzLl9wcm9maWxlVGl0bGUudGV4dENvbnRlbnQgPSBwcm9maWxlVGl0bGVcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0VXNlckF2YXRhcigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBwcm9maWxlTmFtZTogdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQsXHJcbiAgICAgICAgICAgIHByb2ZpbGVUaXRsZTogdGhpcy5fcHJvZmlsZVRpdGxlLnRleHRDb250ZW50XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldFVzZXJBdmF0YXIoYXZhdGFyKSB7XHJcblxyXG4gICAgICAgIHRoaXMuX2F2YXRhci5zcmMgPSBhdmF0YXJcclxuICAgIH1cclxuXHJcbn0iLCJpbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi9Qb3B1cFdpdGhGb3JtXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhTdWJtaXQgZXh0ZW5kcyBQb3B1cFdpdGhGb3JtIHtcclxuICAgIHNldEFjdGlvbihhY3Rpb24pIHtcclxuICAgICAgICB0aGlzLl9zdWJtaXRIYW5kbGVyID0gYWN0aW9uXHJcbiAgICB9XHJcblxyXG4gICAgLyogICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgdGhpcy5fc3VibWl0SGFuZGxlcilcclxuICAgICAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKVxyXG4gICAgICAgIH0gKi9cclxuXHJcbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yKHNlbGVjdG9yKSB7XHJcbiAgICAgICAgc3VwZXIoc2VsZWN0b3IpXHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIub3ZlcmxheV9faW1nXCIpXHJcblxyXG4gICAgfVxyXG4gICAgb3Blbih7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5vdmVybGF5X190ZXh0XCIpXHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZS5zcmMgPSBsaW5rXHJcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZS5hbHQgPSBuYW1lXHJcbiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSBuYW1lXHJcbiAgICAgICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICAgIHN1cGVyLm9wZW4oKVxyXG4gICAgfVxyXG5cclxufSJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsInAiLCJGb3JtVmFsaWRhdG9yIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJmb3JtRWxlbWVudCIsInRoaXMiLCJfZm9ybUVsZW1lbnQiLCJfY29uZmlnIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImlkIiwiY2xhc3NMaXN0IiwiYWRkIiwiZXJyb3JDbGFzcyIsInRleHRDb250ZW50IiwiaW5wdXRFcnJvckNsYXNzIiwiX2hpZGVJbnB1dEVycm9yIiwicmVtb3ZlIiwiX2hhc0ludmFsaWRJbnB1dCIsIl9pbnB1dExpc3QiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsIl90b2dnbGVCdXR0b25TdGF0ZSIsIl9idXR0b25FbGVtZW50IiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImRpc2FibGVkIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsImFkZEV2ZW50TGlzdGVuZXIiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImJpbmQiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiZm9yRWFjaCIsInJlc2V0VmFsaWRhdGlvbiIsImVuYWJsZVZhbGlkYXRpb24iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsIkNhcmQiLCJjYXJkRGF0YSIsInNlbGVjdG9yIiwiY2FyZENsaWNrIiwiY2FyZERlbGV0ZSIsImNhcmRMaWtlIiwidXNlcklkIiwiX2hhbmRsZUNhcmRDbGljayIsIl9oYW5kbGVDYXJkRGVsZXRlIiwiX2hhbmRsZUNhcmRMaWtlIiwiY2FyZE93bmVySWQiLCJvd25lciIsIl9pZCIsImNhcmRJZCIsIl9uYW1lIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9saWtlcyIsImxpa2VzIiwiX2NhcmRUZW1wbGF0ZSIsImRvY3VtZW50IiwiY29udGVudCIsIl9jYXJkRWxlbWVudCIsImNsb25lTm9kZSIsIl9jYXJkTGlrZXNDb3VudCIsIl9jYXJkTGlrZSIsIl9jYXJkRGVsZXRlRWxtIiwiX2NhcmRJbWdFbG0iLCJkYXRhIiwic3JjIiwiYWx0IiwicmVtb3ZlQ2FyZCIsImlzTGlrZWQiLCJsaWtlIiwidG9nZ2xlTGlrZSIsImxpa2VzUmVzcG9uc2UiLCJsZW5ndGgiLCJjcmVhdGVDYXJkIiwiY2FyZE5hbWVFbG0iLCJzZXRBdHRyaWJ1dGUiLCJjYXJkIiwiaW5kZXhJbWFnZVVybHMiLCJmb3JtQ29uZmlnSW5kZXgiLCJQb3B1cCIsImUiLCJrZXkiLCJjbG9zZSIsImVsbUNsYXNzTGlzdCIsInRhcmdldCIsImNvbnRhaW5zIiwic3RvcFByb3BhZ2F0aW9uIiwiX3BvcHVwIiwib3BlbiIsInNldEV2ZW50TGlzdGVuZXJzIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIl9oYW5kbGVDbG9zZSIsIl9oYW5kbGVFc2NDbG9zZSIsIlBvcHVwV2l0aEZvcm0iLCJwb3B1cFNlbGVjdG9yIiwic3VibWl0SGFuZGxlciIsInN1cGVyIiwiX3N1Ym1pdEhhbmRsZXIiLCJfZm9ybSIsIl9oYW5kbGVTdWJtaXQiLCJfc3VibWl0QnV0dG9uIiwiX3N1Ym1pdEJ1dHRvblRleHRCZWZvcmVMb2FkaW5nIiwiX2dldElucHV0VmFsdWVzIiwiaW5wdXRWYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwiX3NldExvYWRpbmciLCJfcmVtb3ZlTG9hZGluZyIsInJlc2V0IiwiU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXIiLCJpdGVtIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ1cmwiLCJvcHRpb25zIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1c1RleHQiLCJjYXRjaCIsImVycm9yIiwiY29uc29sZSIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRVc2VySW5mbyIsImN1c3RvbUZldGNoIiwiZ2V0SW5pdGlhbENhcmRzIiwiY3JlYXRlTmV3Q2FyZCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwic2V0UHJvZmlsZUluZm8iLCJ1c2VyT2JqIiwicHJvZmlsZU5hbWUiLCJhYm91dCIsInByb2ZpbGVUaXRsZSIsImF2YXRhciIsInByb2ZpbGVBdmF0YXIiLCJkZWxldGVDYXJkIiwiYWRkTGlrZSIsInJlbW92ZUxpa2UiLCJzZXRBdmF0YXIiLCJhdXRob3JpemF0aW9uIiwiY2FyZEZvcm1TZWxlY3RvciIsInByb2ZpbGVGb3JtU2VsZWN0b3IiLCJwcm9maWxlQXZhdGFyRm9ybVNlbGVjdG9yIiwicHJvZmlsZUZvcm0iLCJwcm9maWxlQXZhdGFyRm9ybSIsInVzZXJJbmZvIiwiX3Byb2ZpbGVOYW1lIiwicHJvZmlsZU5hbWVTZWxlY3RvciIsIl9wcm9maWxlVGl0bGUiLCJwcm9maWxlVGl0bGVTZWxlY3RvciIsIl9hdmF0YXIiLCJwcm9maWxlQXZhdGFyU2VsZWN0b3IiLCJzZXRVc2VySW5mbyIsImdldFVzZXJBdmF0YXIiLCJzZXRVc2VyQXZhdGFyIiwiY2FyZEZvcm0iLCJjYXJkTGlzdFNlY3Rpb24iLCJjYXJkc0xvYWRpbmciLCJwb3B1cERlbGV0ZUNhcmQiLCJzZXRBY3Rpb24iLCJhY3Rpb24iLCJwb3B1cFdpdGhJbWFnZSIsIl9wb3B1cEltYWdlIiwidGl0bGUiLCJwb3B1cEFkZENhcmQiLCJhZGRDYXJkIiwicG9wdXBQcm9maWxlIiwicG9wdXBBdmF0YXJFZGl0IiwiY2FyZEZvcm1WYWxpZGF0b3IiLCJwcm9maWxlRm9ybVZhbGlkYXRvciIsInByb2ZpbGVBdmF0YXJGb3JtVmFsaWRhdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlQ2FyZERlbGV0ZSIsImhhbmRsZUNhcmRMaWtlIiwiaW1hZ2VEYXRhIiwiYWxsIiwidXNlciIsImNhcmRJdGVtcyIsImhlYWRlckxvZ28iLCJmYXZpY29uIiwibG9hZGluZ0JsdWVVcmwiLCJoZWFkZXJMb2dvVVJMIiwiZmF2aWNvblVSTCIsImhyZWYiLCJpbml0SW5kZXhJbWFnZXMiLCJ1c2VyTmFtZSIsInVzZXJKb2IiLCJmaWxsUHJvZmlsZUZvcm0iXSwic291cmNlUm9vdCI6IiJ9